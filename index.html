<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OpenSlots – Slot Model Picker</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700;900&display=swap" rel="stylesheet">
<style>
:root{--bg:rgb(239,238,231);--bg-secondary:#f5f5f5;--card:#ffffff;--ink:#212529;--muted:#6c757d;--accent:rgb(91,88,165);--accent-alt:rgb(91,88,165);--accent-purple:rgb(91,88,165);--border-primary:rgba(91,88,165,.2);--border-glow:rgba(91,88,165,.4);--glow-cyan:0 2px 8px rgba(91,88,165,.15);--glow-magenta:0 2px 8px rgba(91,88,165,.15);--glow-purple:0 2px 8px rgba(91,88,165,.15)}
@keyframes glitch{0%,100%{transform:translate(0)}20%{transform:translate(-2px,2px)}40%{transform:translate(-2px,-2px)}60%{transform:translate(2px,2px)}80%{transform:translate(2px,-2px)}}
*{box-sizing:border-box}
body{margin:0;font-family:'Roboto',system-ui,sans-serif;background:var(--bg);color:var(--ink);-webkit-font-smoothing:antialiased}
.wrap{max-width:980px;margin:48px auto;padding:0 20px;position:relative;z-index:1}
.card{background:var(--card);border:1px solid #eef1f4;border-radius:12px;padding:32px;box-shadow:0 4px 12px rgba(91,88,165,0.12)}
h1{font-size:32px;margin:0 0 8px;font-weight:900;letter-spacing:2px;text-transform:uppercase;background:linear-gradient(135deg,var(--accent),var(--accent-alt));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;animation:glitch 5s ease-in-out infinite}
.sub{color:var(--muted);margin-bottom:24px;font-weight:400;letter-spacing:.5px}
.cta{display:flex;gap:12px;flex-wrap:wrap}
button{appearance:none;border:2px solid #e0e4e8;background:#fff;color:var(--ink);padding:10px 24px;border-radius:50px;cursor:pointer;transition:all .25s cubic-bezier(.4,0,.2,1);font-family:'Roboto',sans-serif;font-weight:600;font-size:14px;clip-path:polygon(8px 0,100% 0,100% calc(100% - 8px),calc(100% - 8px) 100%,0 100%,0 8px)}
button:hover{border-color:var(--accent);color:var(--accent);background:#f0f2f5;transform:translateY(-1px)}
button:active{transform:translateY(0)}
button.primary{background:rgb(91,88,165);color:#fff;border:none;font-weight:600;box-shadow:0 2px 8px rgba(91,88,165,.15)}
button.primary:hover{box-shadow:0 4px 12px rgba(91,88,165,.2);transform:translateY(-1px);background:rgb(91,88,165);color:#fff}
hr.sep{border:none;border-top:1px solid var(--border-primary);margin:24px 0}
.stepper{display:flex;gap:8px;margin-bottom:16px;flex-wrap:wrap}
.pill{padding:8px 14px;border-radius:20px;background:var(--bg-secondary);color:var(--muted);font-size:11px;border:1px solid var(--border-primary);text-transform:uppercase;letter-spacing:1px;font-weight:500}
.pill.active{background:rgb(91,88,165);color:#fff;font-weight:700;box-shadow:0 0 10px rgba(124,58,237,.3);border-color:transparent}
.q{margin:8px 0 4px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;font-size:14px;color:var(--accent)}
.opts{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px}
.opt{border:1px solid var(--border-primary);background:var(--bg-secondary);border-radius:0;padding:14px;cursor:pointer;transition:.12s;clip-path:polygon(6px 0,100% 0,100% calc(100% - 6px),calc(100% - 6px) 100%,0 100%,0 6px);font-size:13px;font-weight:500}
.opt:hover{border-color:var(--border-glow);background:var(--card);box-shadow:var(--glow-cyan)}
.opt input{margin-right:8px;accent-color:var(--accent)}
.help{color:var(--muted);font-size:11px;margin-top:6px;letter-spacing:.5px}
.hidden{display:none}
.models{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:16px}
.badge{display:inline-block;padding:3px 10px;border-radius:12px;background:var(--bg-secondary);border:1px solid var(--border-primary);font-size:11px;text-transform:uppercase;letter-spacing:.5px;font-weight:500}
.model-card{background:var(--card);border:1px solid var(--border-primary);border-radius:0;padding:20px;box-shadow:var(--glow-cyan);transition:all .15s ease;clip-path:polygon(12px 0,100% 0,100% calc(100% - 12px),calc(100% - 12px) 100%,0 100%,0 12px);font-size:15.6px}
.model-card:hover{border-color:var(--border-glow);box-shadow:var(--glow-purple);transform:translateY(-2px)}
.kv{display:grid;grid-template-columns:auto 1fr;gap:8px 16px;font-size:15.6px}
.kv>div:nth-child(odd){color:var(--muted);text-transform:uppercase;font-size:13.2px;letter-spacing:.5px}
.result{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;margin-top:16px}
@media(max-width:820px){.opts{grid-template-columns:1fr}.models{grid-template-columns:1fr}.result{grid-template-columns:1fr}}

.focus-mode .hero{display:none!important}.focus-mode #models{display:none!important}
#focusBar{display:none}.focus-mode #focusBar{display:flex!important}
#focusMount{display:none}.focus-mode #focusMount{display:block!important}
#focusBar{position:sticky;top:0;z-index:50;gap:8px;align-items:center;justify-content:space-between;padding:10px 12px;margin:8px 0 12px;background:var(--card);border:1px solid var(--border-primary);border-radius:0;box-shadow:var(--glow-cyan);clip-path:polygon(12px 0,100% 0,100% calc(100% - 12px),calc(100% - 12px) 100%,0 100%,0 12px)}
#focusBar #focusLabel{color:var(--accent);font-weight:700;text-transform:uppercase;letter-spacing:1px}
#focusMount{max-width:980px;margin:0 auto;padding:0 20px}

.btn{appearance:none;border:1px solid var(--border-primary);background:var(--bg-secondary);color:var(--ink);padding:8px 12px;border-radius:0;cursor:pointer;font-family:'Roboto',sans-serif;text-transform:uppercase;letter-spacing:1px;font-size:12px;clip-path:polygon(6px 0,100% 0,100% calc(100% - 6px),calc(100% - 6px) 100%,0 100%,0 6px);font-weight:600;transition:all .15s ease}
.btn:hover{background:var(--card);border-color:var(--border-glow);box-shadow:var(--glow-cyan)}
.btn-rose{background:rgb(91,88,165)!important;color:white!important;border:none!important;padding:10px 14px;font-weight:700;cursor:pointer;box-shadow:var(--glow-magenta);clip-path:polygon(8px 0,100% 0,100% calc(100% - 8px),calc(100% - 8px) 100%,0 100%,0 8px);border-radius:0}
.btn-rose:hover{box-shadow:0 4px 12px rgba(91,88,165,.3)}
.btn.primary{background:rgb(91,88,165)!important;color:#fff!important;border:none!important;font-weight:700}

#tuneModalBack{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(10,14,23,.65);display:none;z-index:9999;overflow-y:auto;backdrop-filter:blur(4px)}
#tuneModal{position:relative;max-width:860px;margin:40px auto;background:var(--card);color:var(--ink);border:1px solid var(--border-primary);border-radius:12px;padding:24px;box-shadow:0 20px 60px rgba(0,0,0,.15);z-index:10000}
#tuneHead{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid var(--border-primary)}
#tuneHead h3{margin:0;font-size:24px;font-weight:900;color:var(--accent);text-transform:uppercase;letter-spacing:2px}
#tuneBody{display:grid;grid-template-columns:1.2fr .8fr;gap:20px}
@media(max-width:860px){#tuneBody{grid-template-columns:1fr}}
.tuneCard{background:var(--bg-secondary);border:1px solid var(--border-primary);border-radius:8px;padding:16px}
.rangeRow{display:flex;align-items:center;gap:12px}
.rangeRow input[type=range]{flex:1;height:6px;background:#e2e8f0;border-radius:6px;outline:none;-webkit-appearance:none}
.rangeRow input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:var(--accent);cursor:pointer;border:2px solid #fff;box-shadow:0 0 6px rgba(91,88,165,.3)}
#tuneModal select{appearance:none;background:#fff;border:1px solid var(--border-primary);border-radius:6px;padding:8px 12px;color:var(--ink);font-size:13px;width:100%;cursor:pointer}
#tuneModal label{display:flex;align-items:center;gap:6px;color:var(--ink);cursor:pointer;font-size:13px}
#tuneModal input[type=radio]{accent-color:var(--accent)}

#artCard{background:var(--card);border:1px solid var(--border-primary);border-radius:12px;padding:24px;margin-top:24px;box-shadow:var(--glow-cyan)}
#artCard h3{margin:0 0 16px;font-size:24px;font-weight:900;color:var(--accent)!important;text-align:center;padding-bottom:12px;border-bottom:2px solid var(--accent-purple);text-transform:uppercase;letter-spacing:2px}
.qrow{margin:20px 0 24px}.qrow label{display:block;font-weight:700;font-size:14px;margin-bottom:8px;color:var(--accent);text-transform:uppercase;letter-spacing:1px}
.qrow .help{color:var(--muted);font-size:12px;margin:6px 0 12px;line-height:1.5}
.qrow textarea,.qrow input[type=text],.qrow input[type=email]{width:100%;border-radius:6px;border:1px solid var(--border-primary);background:var(--bg-secondary);color:var(--ink);padding:12px 14px;font-size:14px;font-family:'Roboto',sans-serif;transition:all .15s ease}
.qrow textarea{min-height:100px;line-height:1.5}
.qrow textarea:focus,.qrow input[type=text]:focus,.qrow input[type=email]:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(91,88,165,.15)}
#themeChips,#visualStyleChips,#atmosphereChips{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0}
.theme-chip{display:inline-block;padding:8px 14px;border-radius:20px;background:var(--bg-secondary);border:1px solid var(--border-primary);color:var(--ink);font-size:12px;cursor:pointer;transition:all .12s ease;user-select:none;font-weight:500}
.theme-chip:hover{background:var(--card);color:var(--accent);border-color:var(--border-glow)}
.theme-chip.selected{background:rgb(91,88,165);color:white;border-color:transparent;font-weight:700}
#artPrompt{width:100%;min-height:120px;border-radius:6px;border:1px solid var(--border-primary);background:var(--bg);color:var(--ink);padding:14px;font-size:13px;line-height:1.5;font-family:'Courier New',monospace;resize:vertical}
.ref-image-slot{display:flex;flex-direction:column;gap:8px;align-items:center}
.ref-image-preview{width:120px;height:120px;border:2px dashed var(--border-primary);background:var(--bg-secondary);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .15s ease;overflow:hidden;border-radius:8px}
.ref-image-preview:hover{border-color:var(--accent);box-shadow:0 0 0 3px rgba(91,88,165,.1)}
.ref-image-preview img{width:100%;height:100%;object-fit:cover}
.ref-image-placeholder{color:var(--muted);font-size:12px;font-weight:500}
.ref-image-preview.has-image .ref-image-placeholder{display:none}
.ref-image-remove{padding:4px 12px;font-size:11px;background:rgba(255,107,107,.1);border:1px solid rgba(255,107,107,.3);color:#e53e3e;border-radius:6px}
.personalize-btn{appearance:none;background:rgb(91,88,165)!important;color:white!important;border:none!important;padding:10px 16px;border-radius:0;cursor:pointer;font-weight:700;transition:all .15s ease;text-transform:uppercase;letter-spacing:1px;font-size:12px;clip-path:polygon(6px 0,100% 0,100% calc(100% - 6px),calc(100% - 6px) 100%,0 100%,0 6px);box-shadow:var(--glow-magenta)!important}
.personalize-btn:hover{box-shadow:0 4px 12px rgba(91,88,165,.3)!important;transform:translateY(-1px) scale(1.02)!important}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.rtp-accordion{margin-top:12px}
.rtp-accordion-header{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:var(--bg-secondary);border:1px solid var(--border-primary);border-radius:8px;cursor:pointer;transition:all .15s ease;user-select:none;margin-bottom:4px}
.rtp-accordion-header:hover{border-color:var(--border-glow);background:var(--card);box-shadow:var(--glow-cyan)}
.rtp-accordion-header .rtp-label{font-weight:700;color:var(--accent);font-size:14px;text-transform:uppercase;letter-spacing:1px}
.rtp-accordion-header .rtp-chevron{color:var(--accent);font-size:14px;transition:transform .2s ease}
.rtp-accordion-header.open .rtp-chevron{transform:rotate(180deg)}
.rtp-accordion-body{max-height:0;overflow:hidden;transition:max-height .3s ease;padding:0 2px}
.rtp-accordion-body.open{max-height:600px}
.rtp-accordion-body .rtp-panel{background:var(--bg-secondary);border:1px solid var(--border-primary);border-radius:8px;padding:14px;margin-bottom:8px}

.mine-type-badge{display:inline-block;padding:4px 12px;border-radius:16px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px}
.mine-type-badge.mine{background:linear-gradient(135deg,#00B140,#00963a);color:#fff}
.mine-type-badge.slot{background:linear-gradient(135deg,var(--accent),#7c3aed);color:#fff}
</style>
</head><body>
<div class="wrap">
  <div style="text-align:left;margin-bottom:32px;padding-bottom:24px;border-bottom:3px solid rgb(91,88,165);">
    <div style="font-size:28px;font-weight:900;color:var(--accent);letter-spacing:3px;text-transform:uppercase;">OpenSlots · Game Producer</div>
  </div>
  <div class="card">
    <div style="text-align:center;max-width:700px;margin:0 auto;">
      <h1>Welcome! I'm your AI Game Producer assistant.</h1>
      <p class="sub" style="color:var(--ink);">I'll guide you through creating the perfect game tailored to your vision and audience.</p>
      <p style="color:var(--muted);font-size:14px;"><strong style="color:var(--accent-alt);">Explore Models</strong> — Browse slot & game templates with detailed specifications.</p>
      <p style="color:var(--ink);margin-top:24px;">Let's get started:</p>
      <div class="cta" style="justify-content:center;">
        <button id="modelsBtn" style="background:rgb(91,88,165);color:white;font-weight:700;border:none;box-shadow:var(--glow-magenta);">Show Me Models</button>
      </div>
    </div>
    <hr class="sep"/>
    <section id="models" class="hidden"><div class="q">Explore Models</div><div id="modelsWrap" class="models"></div></section>
    <section id="resultBox" style="display:none"><div class="result"><div><div class="model-card"><div id="r-model" style="font-size:24px;font-weight:900;color:var(--accent);margin-bottom:16px;text-align:center;text-transform:uppercase;letter-spacing:2px;"></div><div class="kv" id="r-kv"><div>Grid</div><div id="r-grid"></div><div>Volatility</div><div id="r-vol"></div><div>RTP profiles</div><div id="r-rtp"></div><div>EV split</div><div id="r-ev"></div><div>Base hit-rate</div><div id="r-hit"></div><div>Feature cadence</div><div id="r-cad"></div><div>Max win</div><div id="r-max"></div><div>Jackpots</div><div id="r-jp"></div><div>Toggles</div><div id="r-tog"></div></div><div id="r-extra"></div><div class="mt12" style="display:flex;justify-content:space-between;gap:12px;align-items:center;margin-top:16px;"><div style="display:flex;gap:8px;"></div><div style="display:flex;gap:8px;"><button id="artBtn" class="btn-rose">Create Game</button></div></div></div></div></div></section>
  </div>
</div>
<div id="focusMount"></div>
<div id="tuneModalBack"><div id="tuneModal"><div id="tuneHead"><h3>Personalise</h3><div class="row"><button class="btn" id="tuneCancel">Cancel</button><button class="btn primary" id="tuneApply">Apply</button></div></div><div id="tuneBody"><div class="tuneCard"><div class="kv"><div>Model</div><div><span id="tModel" class="badge"></span></div><div>Grid</div><div><select id="iGrid"></select></div><div id="lineCountRow" style="display:none">Line count</div><div id="lineCountControl" style="display:none"><input id="iLineCount" type="range" min="10" max="20" value="10"><span id="oLineCount" class="help">10 lines</span></div><div>Risk & thrill</div><div class="rangeRow"><input id="iRisk" type="range" min="0" max="100" value="50"><span id="oRisk" class="help">Balanced</span></div><div>Bonus frequency</div><div><label class="help"><input type="radio" name="appetite" value="often"> Often</label><label class="help"><input type="radio" name="appetite" value="sometimes" checked> Sometimes</label><label class="help"><input type="radio" name="appetite" value="rare"> Rare but big</label></div><div>Max-win target</div><div><label class="help"><input type="radio" name="maxwin" value="5000-10000"> 5k–10k×</label><label class="help"><input type="radio" name="maxwin" value="10000-20000" checked> 10k–20k×</label><label class="help"><input type="radio" name="maxwin" value="20000-30000"> 20k–30k×</label></div><div>RTP profile</div><div><select id="iRTP"></select></div></div><div class="help" style="margin-top:8px">Preview updates instantly.</div></div><div class="tuneCard"><div class="kv"><div>Suggested grid</div><div id="oGrid"></div><div>Symbols</div><div id="oSymbols"></div><div>Volatility</div><div id="oVol"></div><div>EV split</div><div id="oEV"></div><div>RTP</div><div id="oRTP"></div><div>Base hit-rate</div><div id="oHit"></div><div>Feature cadence</div><div id="oCad"></div><div>Max win</div><div id="oMax"></div></div></div></div></div></div>
<script>
// MODELS DB
const MODELS=[
{id:"HoldAndWinRespin",name:"Hold & Win Respins with Lock/Collect",gameType:"slot",canonical_grid:"5x3",grid_variants:["5x3"],lines:5,rtp_versions:{96:{rtp:"96.03%",ev_split:{base:36.01,coin_feature:34.01,coin_extra:26.00},hit_ratio:"14.44%",feature_cadence:{coin_feature:113.01,coin_extra:147.74},max_win:"6000×"},94:{rtp:"94.03%",ev_split:{base:35.25,coin_feature:33.29,coin_extra:25.49},hit_ratio:"14.13%",feature_cadence:{coin_feature:113.01,coin_extra:147.40},max_win:"6000×"}},rtp_profiles:["96.03%","94.03%"],volatility:"Med–High",base_hit_rate_target_percent:"14.44",feature_cadence_target_1inN:"113",ev_split_target:{base:36,feature:64},max_win_target_x:"6,000",jackpots_supported:true,notes:["Cash symbols trigger respins","Jackpot tiers: Mini, Minor, Major, Grand","5 fixed paylines"]},
{id:"HoldAndWin20Lines",name:"Hold & Win 20 Lines & Random Bonus",gameType:"slot",canonical_grid:"5x3",grid_variants:["5x3"],lines:20,rtp_versions:{96:{rtp:"95.99%",ev_split:{base:35.00,free_spins:15.02,coin_feature:25.99,coin_extra:19.98},hit_ratio:"23.53%",feature_cadence:{coin_feature:136.54,coin_extra:192.08,free_spins:319.58},max_win:"1500×"},94:{rtp:"94.00%",ev_split:{base:34.49,free_spins:14.49,coin_feature:25.49,coin_extra:19.53},hit_ratio:"23.65%",feature_cadence:{coin_feature:134.01,coin_extra:192.08,free_spins:324.05},max_win:"1500×"}},rtp_profiles:["95.99%","94.00%"],volatility:"Med–High",base_hit_rate_target_percent:"23.53",feature_cadence_target_1inN:"136",ev_split_target:{base:35,feature:65},max_win_target_x:"1,500",jackpots_supported:true,notes:["3 bonus modes: Free Spins, Coin Feature, Coin Extra","Jackpot tiers: Mini, Minor, Major, Grand","20 fixed paylines"]},
{id:"PayAnywhere",name:"Pay Anywhere (Scatter Pays + Tumble)",gameType:"slot",canonical_grid:"6x5 (anywhere 8+)",grid_variants:["7x7 (smoother)","5x6 (tighter)"],rtp_profiles:["96.5%","96.0%","95.5%"],volatility:"High",base_hit_rate_target_percent:"20–26",feature_cadence_target_1inN:"180–240",ev_split_target:{base:40,feature:60},max_win_target_x:"15,000–20,000",notes:["Tumbles + multiplier bombs in bonus","Bonus-centric EV"]},
{id:"MineGame",name:"Mine Games",gameType:"mine",canonical_grid:"5×5 (25 tiles)",grid_size:25,mine_range:{min:1,max:7},rtp_range:"96.60% – 97.92%",rtp_profiles:["96.60%–97.92%"],max_multiplier:"x3,886",volatility_range:"Low/Med → Very High (scales with mines)",bet_range:{min:0.50,default:1,max:50},symbols:2,jackpots_supported:false,notes:["Player picks tiles to reveal coins or bombs","1–7 selectable mines per round","More mines = higher risk & higher multipliers","Collect anytime or risk it all","Skill-based pick game, not a reel spinner"],
paytable:[
/*         1 mine   2 mines  3 mines  4 mines  5 mines  6 mines  7 mines */
/* 1  */ [1.02,    1.06,    1.11,    1.16,    1.22,    1.28,    1.35],
/* 2  */ [1.05,    1.15,    1.26,    1.39,    1.54,    1.70,    1.90],
/* 3  */ [1.10,    1.26,    1.45,    1.68,    1.96,    2.30,    2.74],
/* 4  */ [1.15,    1.39,    1.68,    2.05,    2.53,    3.17,    4.01],
/* 5  */ [1.21,    1.53,    1.96,    2.54,    3.33,    4.45,    6.01],
/* 6  */ [1.28,    1.70,    2.30,    3.17,    4.44,    6.35,    9.25],
/* 7  */ [1.35,    1.90,    2.75,    4.01,    6.02,    9.25,    14.65],
/* 8  */ [1.43,    2.14,    3.30,    5.16,    8.33,    13.90,   24.00],
/* 9  */ [1.52,    2.43,    4.00,    6.75,    11.80,   21.45,   40.75],
/* 10 */ [1.62,    2.77,    4.90,    9.00,    17.17,   34.35,   72.50],
/* 11 */ [1.73,    3.20,    6.15,    12.26,   25.75,   57.20,   135.85],
/* 12 */ [1.87,    3.73,    7.80,    17.17,   40.05,   100.10,  271.70],
/* 13 */ [2.02,    4.41,    10.15,   24.80,   65.10,   185.90,  588.75],
/* 14 */ [2.20,    5.29,    13.55,   37.20,   111.55,  371.85,  1413.00],
/* 15 */ [2.43,    6.47,    18.60,   58.45,   204.50,  818.00,  3886.00],
/* 16 */ [2.69,    8.08,    26.56,   97.40,   409.00,  2045.00, null],
/* 17 */ [3.03,    10.39,   39.85,   175.30,  920.00,  null,    null],
/* 18 */ [3.46,    13.86,   63.75,   350.60,  null,    null,    null],
/* 19 */ [4.04,    19.40,   111.55,  818.00,  null,    null,    null],
/* 20 */ [4.85,    29.10,   223.10,  null,    null,    null,    null],
/* 21 */ [6.06,    48.50,   558.00,  null,    null,    null,    null],
/* 22 */ [8.08,    97.00,   null,    null,    null,    null,    null],
/* 23 */ [12.13,   291.00,  null,    null,    null,    null,    null],
/* 24 */ [24.25,   null,    null,    null,    null,    null,    null]
]}
];

// CONSTANTS
const BASELINES={Paylines:{rtpProfiles:['96.0%','95.0%','94.0%'],evBase:55,evFeature:45,volatility:'Med',hitRate:'32–36%',cadence:'1 in 210–260',maxWin:'10,000–20,000×'},ClusterPays:{rtpProfiles:['96.0%','95.5%','94.0%'],evBase:58,evFeature:42,volatility:'Med–High',hitRate:'22–24%',cadence:'1 in 140–200',maxWin:'5,000–10,000×'},Megaways:{rtpProfiles:['96.0%','95.0%','94.0%'],evBase:35,evFeature:65,volatility:'High',hitRate:'~20%',cadence:'1 in 160–220',maxWin:'10,000–20,000×'},HoldAndWin:{rtpProfiles:['96.0%','95.5%','94.0%'],evBase:58,evFeature:42,volatility:'Med–High',hitRate:'22–30%',cadence:'1 in 80–150',maxWin:'5,000–10,000×'},OctopusRiches:{rtpProfiles:['96.2%','95.5%','94.0%'],evBase:36,evFeature:64,volatility:'Med–High',hitRate:'28–36%',cadence:'1 in 80–330',maxWin:'1,200–3,000×'},WaysAllWays:{rtpProfiles:['96.0%','95.0%','94.0%'],evBase:70,evFeature:30,volatility:'Med',hitRate:'22–25%',cadence:'(light FS/respins)',maxWin:'10,000–20,000×'}};
const GRID_OPTIONS={Paylines:['3x3','5x3','5x4'],ClusterPays:['5x6','6x5','7x7'],Megaways:['min2-7','min3-7'],HoldAndWin:['3x3','5x3','5x4'],OctopusRiches:['5x3'],WaysAllWays:['5x3/243','5x4/1024','6x4/4096']};
const GRID_TUNING={Paylines:{'3x3':{hitRate:+2,vol:-0.2,evBase:+3,cadence:'1 in 180–240'},'5x3':{},'5x4':{hitRate:-2,vol:+0.2,evBase:-2,cadence:'1 in 230–280'}},ClusterPays:{'5x6':{hitRate:-2,vol:+0.3,evBase:-2,cadence:'1 in 150–210'},'6x5':{},'7x7':{hitRate:+3,vol:-0.3,evBase:+3,cadence:'1 in 120–170'}},Megaways:{'min2-7':{hitRate:-1,vol:+0.3,evBase:-2,cadence:'1 in 170–230'},'min3-7':{hitRate:+1,vol:-0.2,evBase:+2,cadence:'1 in 150–210'}},HoldAndWin:{'3x3':{evBase:62,evFeature:38,cadence:'1 in 60–100',maxWin:'3,000–5,000×'},'5x3':{},'5x4':{evBase:54,evFeature:46,cadence:'1 in 100–180',maxWin:'7,000–12,000×'}},OctopusRiches:{'5x3':{}},WaysAllWays:{'5x3/243':{},'5x4/1024':{hitRate:+2,vol:-0.2,evBase:+2},'6x4/4096':{hitRate:+2,vol:-0.3,evBase:+3}}};
const ART_COUNTS={Paylines:{grids:{"3x3":{total:12,breakdown:{lows:6,highs:3,wild:1,scatter:1,feature:1}},"5x3":{total:15,breakdown:{lows:8,highs:4,wild:1,scatter:1,feature:1}},"5x4":{total:18,breakdown:{lows:10,highs:5,wild:1,scatter:1,feature:1}}}},ClusterPays:{grids:{"5x6":{total:13,breakdown:{lows:6,highs:4,wild:1,scatter:1,mystery:1}},"6x5":{total:13,breakdown:{lows:6,highs:4,wild:1,scatter:1,mystery:1}},"7x7":{total:15,breakdown:{lows:8,highs:4,wild:1,scatter:1,mystery:1}}}},Megaways:{grids:{"min2-7":{total:15,breakdown:{lows:8,highs:4,wild:1,scatter:1,feature:1}},"min3-7":{total:17,breakdown:{lows:10,highs:4,wild:1,scatter:1,feature:1}}}},HoldAndWin:{grids:{"3x3":{total:15,breakdown:{lows:5,highs:3,wild:1,scatter:1,cash:3,jackpots:2}},"5x3":{total:19,breakdown:{lows:6,highs:3,wild:1,scatter:1,cash:4,jackpots:4}},"5x4":{total:21,breakdown:{lows:7,highs:3,wild:1,scatter:1,cash:5,jackpots:4}}}},OctopusRiches:{grids:{"5x3":{total:19,breakdown:{lows:6,highs:3,wild:1,scatter:1,cash:4,jackpots:4}}}},WaysAllWays:{grids:{"5x3/243":{total:15,breakdown:{lows:8,highs:4,wild:1,scatter:1,feature:1}},"5x4/1024":{total:18,breakdown:{lows:10,highs:5,wild:1,scatter:1,feature:1}},"6x4/4096":{total:20,breakdown:{lows:12,highs:5,wild:1,scatter:1,feature:1}}}}};

// MATH
const VOL_LADDER=['Low','Low–Med','Med','Med–High','High'];
function bumpVol(b,d){const i=Math.max(0,VOL_LADDER.indexOf(b));return VOL_LADDER[Math.max(0,Math.min(VOL_LADDER.length-1,Math.round(i+d*2)))];}
function shiftBand(band,d){const m=band.match(/(\d+)[–-](\d+)%/);if(!m)return band;return`${Math.max(0,+m[1]+d)}–${Math.min(100,+m[2]+d)}%`;}
function computeMath(mk,g){const b=BASELINES[mk];if(!b)return null;const d=GRID_TUNING[mk]?.[g]||{};const ev=Math.max(0,Math.min(100,(b.evBase??50)+(d.evBase??0)));return{rtpProfiles:b.rtpProfiles,evBase:ev,evFeature:100-ev,volatility:bumpVol(b.volatility,d.vol??0),hitRate:d.hitRate?shiftBand(b.hitRate,d.hitRate):b.hitRate,cadence:d.cadence||b.cadence,maxWin:d.maxWin||b.maxWin};}
function getSymbolCounts(mk,g){const d=ART_COUNTS[mk];if(d?.grids?.[g])return d.grids[g];return{total:12,breakdown:{lows:6,highs:4,wild:1,scatter:1}};}
function formatSymbolBreakdown(sd){if(!sd?.breakdown)return"—";const b=sd.breakdown,p=[];if(b.lows)p.push(b.lows+' Low');if(b.highs)p.push(b.highs+' High');if(b.wild)p.push(b.wild+' Wild');if(b.scatter)p.push(b.scatter+' Scatter');if(b.feature)p.push(b.feature+' Feature');if(b.cash)p.push(b.cash+' Cash');if(b.jackpots)p.push(b.jackpots+' JP');if(b.mystery)p.push(b.mystery+' Mystery');return sd.total+' total ('+p.join(', ')+')';}
function computeSuggestion(mk,g,opts={}){let mr=computeMath(mk,g);const sd=getSymbolCounts(mk,g);const risk=opts.riskDial||50;const bf=opts.bonusFreq||'sometimes';function mapR(r){const base=Math.round(70-.3*r);const f=100-base;let v=base>=65?"Low–Med":base>=55?"Med":base>=45?"Med–High":"High";const mx=r>=75?"20,000–30,000":r>=50?"10,000–20,000":"5,000–10,000";return{base,feature:f,vol:v,max:mx};}function pickC(a){return a==="often"?"90–120":a==="rare"?"180–300":"120–180";}const rm=mapR(risk);const cb=pickC(bf);return{suggestedGrid:g,symbols:sd,volatility:mr?.volatility||rm.vol,evSplit:mr?mr.evBase+'% base / '+mr.evFeature+'% feature':rm.base+'% base / '+rm.feature+'% feature',rtpProfiles:mr?.rtpProfiles||["96.0%","95.5%","94.0%"],hitRate:mr?.hitRate||"22–26%",cadence:mr?.cadence||'1 in '+cb,maxWin:mr?.maxWin||rm.max+'×',lineCount:opts.lineCount,paylinesPatterns:opts.paylinesPatterns};}
const PAYLINES_10=[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[0,1,2,1,0],[2,1,0,1,2],[0,0,1,2,2],[2,2,1,0,0],[0,1,1,1,0],[2,1,1,1,2],[0,2,0,2,0]];
function buildPaylines20(){const b=PAYLINES_10.slice();const m=b.map(p=>p.map(r=>2-r));return[...b,...m].slice(0,20);}

// PERSONALIZE STORE
const PersonalizeStore=(function(){const s={byId:{}};return{apply(id,d){s.byId[id]=d;window.dispatchEvent(new CustomEvent('personalizationStoreUpdated',{detail:{slotId:id,data:d}}));},clear(id){delete s.byId[id];},get(id){return s.byId[id]||null;},getAll(){return{...s.byId};}};})();
window.PersonalizeStore=PersonalizeStore;
function makeSlotId(s){if(s?.focusId)return'focus:'+s.focusId;if(s?.id)return'slot:'+s.id;if(s?.modelId)return'model:'+s.modelId;return'label:'+(s?.title||'unknown');}
window.makeSlotId=makeSlotId;

// PERSONALIZE MODAL
(function(){function nk(l){const s=(l||'').toLowerCase();if(s.includes('paylines')||s.includes('line'))return'Paylines';if(s.includes('cluster'))return'ClusterPays';if(s.includes('mega'))return'Megaways';if(s.includes('ways'))return'WaysAllWays';if(s.includes('octopus'))return'OctopusRiches';if(s.includes('hold')||s.includes('win'))return'HoldAndWin';return'WaysAllWays';}
const back=document.getElementById('tuneModalBack');let ctx={modelId:"HoldAndWin",modelKey:"HoldAndWin",grid:"5x3",lineCount:10,rtp:["96.0%","95.5%","94.0%"],slot:null,slotId:null};
const MN={'Paylines':'Paylines (Classic Line Wins)','ClusterPays':'Cluster Pays (Anywhere + Tumble)','Megaways':'Megaways (Dynamic Reels/Rows)','HoldAndWin':'Hold & Win (Respins with Lock/Collect)','WaysAllWays':'Ways / All Ways Pays','OctopusRiches':'Octopus Riches'};
function openModal(mid,bv,bh,bc,rt,so){const mk=nk(mid);const go=GRID_OPTIONS[mk]||['5x3'];const dg=go[0]||'5x3';let slot,slotId;if(typeof so==='object'&&so!==null){slot=so;slotId=makeSlotId(slot);}else{slot={modelId:mid,title:mid};slotId=so||'model:'+mid;}ctx={modelId:mid,modelKey:mk,grid:dg,lineCount:10,rtp:rt||["96.0%","95.5%","94.0%"],slot,slotId};const ex=PersonalizeStore.get(slotId);if(ex){ctx.grid=ex.grid||ctx.grid;ctx.lineCount=ex.lineCount||ctx.lineCount;}document.getElementById('tModel').textContent=MN[mk]||mk;const gs=document.getElementById('iGrid');gs.innerHTML="";go.forEach(g=>{const o=document.createElement('option');o.value=g;o.textContent=g;gs.appendChild(o);});gs.value=ctx.grid;const ip=mk==='Paylines';document.getElementById('lineCountRow').style.display=ip?'block':'none';document.getElementById('lineCountControl').style.display=ip?'block':'none';if(ip){document.getElementById('iLineCount').value=ctx.lineCount;document.getElementById('oLineCount').textContent=ctx.lineCount+' lines';}const rs=document.getElementById('iRTP');rs.innerHTML="";ctx.rtp.forEach(v=>{const o=document.createElement('option');o.textContent=v;rs.appendChild(o);});if(ex){document.getElementById('iRisk').value=ex.riskDial||50;document.getElementById('iLineCount').value=ex.lineCount||10;gs.value=ex.grid||ctx.grid;const ar=document.querySelector('input[name=appetite][value="'+(ex.bonusFreq||'sometimes')+'"]');if(ar)ar.checked=true;const mr=document.querySelector('input[name=maxwin][value="'+(ex.maxWinTarget||'10000-20000')+'"]');if(mr)mr.checked=true;}else{document.getElementById('iRisk').value=50;document.querySelector('input[name=appetite][value="sometimes"]').checked=true;document.querySelector('input[name=maxwin][value="10000-20000"]').checked=true;}recalc();back.style.display="block";}
function closeModal(){back.style.display="none";}
function labelRisk(v){return v<33?"Chill":v<66?"Balanced":"Spiky";}
function recalc(){const risk=+document.getElementById('iRisk').value;document.getElementById('oRisk').textContent=labelRisk(risk);const appetite=document.querySelector('input[name=appetite]:checked').value;const sg=document.getElementById('iGrid').value||ctx.grid;const lc=+document.getElementById('iLineCount').value||ctx.lineCount;const mwv=document.querySelector('input[name=maxwin]:checked').value;ctx.grid=sg;ctx.lineCount=lc;const ip=ctx.modelKey==='Paylines';let pp=null;if(ip){document.getElementById('oLineCount').textContent=lc+' lines';pp=buildPaylines20().slice(0,lc);}const sug=computeSuggestion(ctx.modelKey,sg,{lineCount:ip?lc:undefined,riskDial:risk,bonusFreq:appetite,maxWinTarget:mwv==='20000-30000'?30000:mwv==='5000-10000'?10000:20000,paylinesPatterns:pp});document.getElementById('oGrid').textContent=sug.suggestedGrid;document.getElementById('oSymbols').textContent=formatSymbolBreakdown(sug.symbols);document.getElementById('oVol').textContent=sug.volatility;document.getElementById('oEV').textContent=sug.evSplit;document.getElementById('oRTP').textContent=sug.rtpProfiles.join(', ');document.getElementById('oHit').textContent=sug.hitRate;document.getElementById('oCad').textContent=sug.cadence;document.getElementById('oMax').textContent=sug.maxWin;back.dataset.payload=JSON.stringify(sug);}
back.addEventListener('click',e=>{if(e.target===back)closeModal();});
document.getElementById('tuneCancel').onclick=closeModal;
document.getElementById('tuneApply').onclick=function(){const pl=JSON.parse(back.dataset.payload||'{}');if(PersonalizeStore&&ctx.slotId){PersonalizeStore.apply(ctx.slotId,{modelKey:ctx.modelKey,grid:pl.suggestedGrid,lineCount:pl.lineCount,suggestion:pl,riskDial:+document.getElementById('iRisk').value,bonusFreq:document.querySelector('input[name=appetite]:checked').value,maxWinTarget:document.querySelector('input[name=maxwin]:checked').value});}if(pl.suggestedGrid){const me=document.getElementById('r-model');const ge=document.getElementById('r-grid');const ve=document.getElementById('r-vol');const ee=document.getElementById('r-ev');const he=document.getElementById('r-hit');const ce=document.getElementById('r-cad');const mx=document.getElementById('r-max');const re=document.getElementById('r-rtp');if(me)me.textContent=MN[ctx.modelKey]||ctx.modelId;if(ge){let gt=pl.suggestedGrid||"";if(pl.lineCount&&ctx.modelKey==='Paylines')gt+=' / '+pl.lineCount+' lines';ge.textContent=gt;}if(ve)ve.textContent=pl.volatility||"";if(ee)ee.textContent=pl.evSplit||"";if(he)he.textContent=pl.hitRate||"";if(ce)ce.textContent=pl.cadence||"";if(mx)mx.textContent=pl.maxWin||"";if(re)re.textContent=Array.isArray(pl.rtpProfiles)?pl.rtpProfiles.join(', '):"";} window.currentGridData={modelKey:ctx.modelKey,grid:pl.suggestedGrid,symbols:pl.symbols,lineCount:pl.lineCount};closeModal();window.dispatchEvent(new CustomEvent('personalizationApplied',{detail:pl}));};
document.getElementById('iGrid').addEventListener('change',recalc);['iRisk','iRTP','iLineCount'].forEach(id=>{const el=document.getElementById(id);if(el)el.addEventListener('input',recalc);});['appetite','maxwin'].forEach(n=>document.querySelectorAll('input[name='+n+']').forEach(r=>r.addEventListener('change',recalc)));
window.openPersonalizeModal=function(mid,bv,bh,bc,rt,so){openModal(mid,bv,bh,bc,rt,so);};})();

// ART STYLE MODULE
(function(){const THEMES=["Mythology","Ancient Civilizations","Vikings/Norse","Asian Culture","Western","Underwater","Space/Sci-fi","Cyberpunk","Fantasy Forest","Steampunk","Adventure/Hunt","Cute Animals","Gems & Luxury","Classic Fruit","Historical Empires","Seasonal/Holiday","Ocean Adventures","Music & Entertainment","Candy/Sweets","Fishing","Sports"];const ATMOSPHERES=["Joyful","Calm","Mysterious","Dark","Serene","Happy","Dynamic","Uncanny","Somber","Austere","Enchanting","Enigmatic","Eerie","Energetic","Lively","Sexy","Lush","Immersive","Adventurous"];const VS=["Cartoon","Comic Book","Doodle Art","Pixel Art","Realistic","Vector","Cartoon Style","Semi-realistic"];
function buildCard(){
  const isMine=window.__selectedGameType==='mine';
  const c=document.createElement('section');c.id="artCard";
  const lowMidLabel=isMine?'8. Mine & Coin Symbol Design <span style="color:#e53e3e">*</span>':'8. Lower/Mid Paying Symbols <span style="color:#e53e3e">*</span>';
  const lowMidHelp=isMine?'Describe your desired Mine (bomb) and Coin symbols. What style should they have?':'';
  const lowMidPlaceholder=isMine?'Examples: Golden doubloon coins with skull engravings, Purple bomb with lit fuse, Crystal gems and dynamite sticks':'Examples: AKJQ10, Fruits and Bells, Candy etc';
  const bgLabel=isMine?'9. Background Setting <span style="color:#e53e3e">*</span>':'9. Background Setting <span style="color:#e53e3e">*</span>';
  const bgPlaceholder=isMine?'Examples: &quot;Pirate ship deck with treasure chests and ocean backdrop&quot; or &quot;Ancient mine shaft with glowing gems and torchlight&quot;':'Examples: &quot;A Chinese pagoda in spring&quot; or &quot;An Egyptian pyramid interior lit up by torches&quot;';

  c.innerHTML='<h3>Game Design Document</h3><div class="help">Answer naturally — our agent will start the creative process.</div><div class="qrow"><label>1. Your Name <span style="color:#e53e3e">*</span></label><input id="qYourName" type="text" placeholder="E.g. John Smith"></div><div class="qrow"><label>2. Company Name <span style="color:#e53e3e">*</span></label><input id="qCompanyName" type="text" placeholder="E.g. Acme Gaming Ltd"></div><div class="qrow"><label>3. Your Email <span style="color:#e53e3e">*</span></label><div class="help">We will email your slot specs and mood board.</div><input id="qEmail" type="email" placeholder="your.email@example.com" required></div><div class="qrow"><label>4. Game Name <span style="color:#e53e3e">*</span></label><div class="help">What would you like to call your game? This helps frame the overall concept.</div><input id="qSlotName" type="text" placeholder="Examples: &quot;Mystic Forest Quest&quot; · &quot;Ocean Treasures&quot; · &quot;Dragon"></div><div class="qrow"><label>5. Visual Style <span style="color:#e53e3e">*</span></label><div class="help">How would you describe the overall look and feel you\'re going for?</div><div id="visualStyleChips"></div></div><div class="qrow"><label>6. Theme <span style="color:#e53e3e">*</span></label><div class="help">What\'s the world or story behind your game? Choose 1 or 2 from themes below:</div><div id="themeChips"></div><input id="qThemeTwist" type="text" placeholder="Optional: add your unique twist (e.g., storm deities and lightning-charged relics)"></div><div class="qrow"><label>7. Main Character or Symbol <span style="color:#e53e3e">*</span></label><div class="help">Describe the most important character or symbol in your game. What do they look like and what are they doing?</div><textarea id="qHero" placeholder="Examples: &quot;A brave knight in golden armor holding up a magical sword&quot; · &quot;A friendly dragon sitting on a pile of treasure&quot;"></textarea></div><div class="qrow"><label>'+lowMidLabel+'</label>'+(lowMidHelp?'<div class="help">'+lowMidHelp+'</div>':'')+'<input id="qLowMidSymbols" type="text" placeholder="'+lowMidPlaceholder+'"></div><div class="qrow"><label>'+bgLabel+'</label><div class="help">Paint me a picture of the environment. What do players see behind the grid?</div><textarea id="qBG" placeholder="'+bgPlaceholder+'"></textarea></div><div class="qrow"><label>10. Colours <span style="color:#e53e3e">*</span></label><div class="help">What colours dominate your game? What feeling should players get when they look at it?</div><textarea id="qMood" placeholder="Examples: Deep blue and white or a gold with hints of red"></textarea></div><div class="qrow"><label>11. Atmosphere <span style="color:#e53e3e">*</span></label><div class="help">Define what it looks like:</div><div id="atmosphereChips"></div><input id="qAtmosphereCustom" type="text" placeholder="Optional: add more descriptors"></div><div class="qrow"><label>12. Reference Images</label><div class="help">Upload up to 3 (JPG/PNG)</div><div id="refImageUploadContainer" style="display:flex;gap:12px;flex-wrap:wrap;margin-top:8px;">'+ [1,2,3].map(i=>'<div class="ref-image-slot"><input type="file" id="refImage'+i+'" accept=".jpg,.jpeg,.png" style="display:none"><div class="ref-image-preview" id="refPreview'+i+'" onclick="document.getElementById(\'refImage'+i+'\').click()"><span class="ref-image-placeholder">+ Image '+i+'</span></div><button type="button" class="ref-image-remove" id="refRemove'+i+'" style="display:none">Remove</button></div>').join('')+'</div></div><div class="qrow"><label>13. Choose Your Markets</label><div class="help">Select all that apply:</div><div id="marketChips" style="display:flex;flex-wrap:wrap;gap:8px;margin:12px 0;"></div><input id="qMarketsOther" type="text" placeholder="Others: enter additional markets separated by commas"></div><div class="qrow"><label>14. Select RTP Profile</label><div class="help">Select one or both:</div><div id="rtpChips" style="display:flex;flex-wrap:wrap;gap:8px;margin:12px 0;"></div></div><div class="qrow" style="text-align:center;margin-top:32px;"><button class="btn-rose" id="btnCreateGame" style="font-size:16px;padding:14px 32px;">Create my Game</button></div>';return c;}
function insertCard(){const ex=document.getElementById('artCard');if(ex){ex.scrollIntoView({behavior:'smooth'});return ex;}const fm=document.getElementById('focusMount');let rb=null;if(fm&&!fm.classList.contains('hidden')){const fb=fm.querySelector('#focusBox')||fm.querySelector('#resultBox');if(fb&&!fb.classList.contains('hidden'))rb=fb;}if(!rb){const r=document.getElementById('resultBox');if(r&&!r.classList.contains('hidden'))rb=r;}if(!rb){alert('Please select a model first.');return null;}const c=buildCard();rb.appendChild(c);wireEvents();renderChips();setTimeout(()=>c.scrollIntoView({behavior:'smooth',block:'center'}),200);return c;}
function renderChips(){const vc=document.getElementById('visualStyleChips');if(vc){vc.innerHTML=VS.map(s=>'<span class="theme-chip">'+s+'</span>').join('');vc.addEventListener('click',e=>{if(e.target.classList.contains('theme-chip'))e.target.classList.toggle('selected');});}const tc=document.getElementById('themeChips');if(tc){tc.innerHTML=THEMES.map(t=>'<span class="theme-chip">'+t+'</span>').join('');tc.addEventListener('click',e=>{if(!e.target.classList.contains('theme-chip'))return;if(e.target.classList.contains('selected'))e.target.classList.remove('selected');else{if(document.querySelectorAll('#themeChips .theme-chip.selected').length<2)e.target.classList.add('selected');else alert('Max 2 themes.');}});}const ac=document.getElementById('atmosphereChips');if(ac){ac.innerHTML=ATMOSPHERES.map(a=>'<span class="theme-chip">'+a+'</span>').join('');ac.addEventListener('click',e=>{if(e.target.classList.contains('theme-chip'))e.target.classList.toggle('selected');});}const mc=document.getElementById('marketChips');if(mc){const MARKETS=["IT","GR","PT","CO","BR","SA"];mc.innerHTML=MARKETS.map(m=>'<span class="theme-chip">'+m+'</span>').join('');mc.addEventListener('click',e=>{if(e.target.classList.contains('theme-chip'))e.target.classList.toggle('selected');});}const rc=document.getElementById('rtpChips');if(rc){let RTPS=["94%","96%"];const selId=window.__selectedModelId;if(selId){const selModel=MODELS.find(m=>m.id===selId);if(selModel&&selModel.rtp_profiles){RTPS=selModel.rtp_profiles;}}rc.innerHTML=RTPS.map(r=>'<span class="theme-chip">'+r+'</span>').join('');rc.addEventListener('click',e=>{if(e.target.classList.contains('theme-chip'))e.target.classList.toggle('selected');});}}
function wireEvents(){document.getElementById('btnCreateGame').onclick=createMyGame;[1,2,3].forEach(s=>{const fi=document.getElementById('refImage'+s);const pv=document.getElementById('refPreview'+s);const rm=document.getElementById('refRemove'+s);if(fi)fi.onchange=e=>{const f=e.target.files[0];if(f){const r=new FileReader();r.onload=ev=>{pv.innerHTML='<img src="'+ev.target.result+'">';pv.classList.add('has-image');rm.style.display='block';};r.readAsDataURL(f);}};if(rm)rm.onclick=e=>{e.stopPropagation();fi.value='';pv.innerHTML='<span class="ref-image-placeholder">+ Image '+s+'</span>';pv.classList.remove('has-image');rm.style.display='none';};});}
function validateForm(){const missing=[];const yn=document.getElementById('qYourName')?.value?.trim();if(!yn)missing.push('Your Name');const cn=document.getElementById('qCompanyName')?.value?.trim();if(!cn)missing.push('Company Name');const em=document.getElementById('qEmail')?.value?.trim();if(!em)missing.push('Your Email');else if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(em))missing.push('Your Email (invalid format)');const gn=document.getElementById('qSlotName')?.value?.trim();if(!gn)missing.push('Game Name');const vs=document.querySelectorAll('#visualStyleChips .theme-chip.selected');if(!vs.length)missing.push('Visual Style (select at least one)');const th=document.querySelectorAll('#themeChips .theme-chip.selected');if(!th.length)missing.push('Theme (select at least one)');const hr=document.getElementById('qHero')?.value?.trim();if(!hr)missing.push('Main Character or Symbol');const lm=document.getElementById('qLowMidSymbols')?.value?.trim();if(!lm)missing.push(window.__selectedGameType==='mine'?'Mine & Coin Symbol Design':'Lower/Mid Paying Symbols');const bg=document.getElementById('qBG')?.value?.trim();if(!bg)missing.push('Background Setting');const cl=document.getElementById('qMood')?.value?.trim();if(!cl)missing.push('Colours');const at=document.querySelectorAll('#atmosphereChips .theme-chip.selected');if(!at.length)missing.push('Atmosphere (select at least one)');return missing;}
function buildPromptInternal(){const sn=document.getElementById('qSlotName')?.value?.trim()||"";const st=Array.from(document.querySelectorAll('#visualStyleChips .theme-chip.selected')).map(c=>c.textContent).join(' / ')||"";const th=Array.from(document.querySelectorAll('#themeChips .theme-chip.selected')).map(c=>c.textContent);const tw=document.getElementById('qThemeTwist')?.value?.trim()||"";let tt=th.length?th.join(' and '):"";if(tw)tt+=" ("+tw+")";const hr=document.getElementById('qHero')?.value?.trim()||"";const lm=document.getElementById('qLowMidSymbols')?.value?.trim()||"";const bg=document.getElementById('qBG')?.value?.trim()||"";const md=document.getElementById('qMood')?.value?.trim()||"";const at=Array.from(document.querySelectorAll('#atmosphereChips .theme-chip.selected')).map(c=>c.textContent);const ac=document.getElementById('qAtmosphereCustom')?.value?.trim()||"";let atx=at.join(', ');if(ac)atx=atx?atx+', '+ac:ac;
  const isMine=window.__selectedGameType==='mine';
  if(isMine){
    return"The image is: "+st+" mine game key art, the theme is: "+tt+".\nA single composition with a detailed background.\nAt the top centre: the game logo \""+sn+"\", glowing highlights.\nBelow the logo: a 5x5 grid of hidden tiles.\n→ COIN symbol: "+hr+", detailed and vibrant.\n→ MINE/BOMB symbol: "+lm+", distinct and dramatic.\nBackground: "+bg+", softly blurred, mood: "+atx+", colour palette: "+md+".\nLighting: cinematic soft glow.\nArt style: HD 2D game illustration, cohesive, vibrant.";
  }
  return"The image is: "+st+" slot game key art, the theme is: "+tt+".\nA single composition with a detailed background.\nAt the top centre: the game logo \""+sn+"\", glowing highlights.\nBelow the logo: exactly TWO framed symbols.\n→ LEFT: high-value symbol showing "+hr+", detailed and vibrant.\n→ RIGHT: lower-paying symbol showing "+lm+", distinct, matching frame style.\nDo not duplicate symbols.\nBackground: "+bg+", softly blurred, mood: "+atx+", colour palette: "+md+".\nLighting: cinematic soft glow.\nArt style: HD 2D slot game illustration, cohesive, vibrant.";}
function createMyGame(){const missing=validateForm();if(missing.length){alert('Please complete the following fields:\n\n• '+missing.join('\n• '));return;}const prompt=buildPromptInternal();const N8N_URL="https://n8n.esagaming.com/webhook/slot-spec-final";const email=document.getElementById('qEmail')?.value?.trim();const yourName=document.getElementById('qYourName')?.value?.trim();const companyName=document.getElementById('qCompanyName')?.value?.trim();const gameName=document.getElementById('qSlotName')?.value?.trim();const styles=Array.from(document.querySelectorAll('#visualStyleChips .theme-chip.selected')).map(c=>c.textContent);const themes=Array.from(document.querySelectorAll('#themeChips .theme-chip.selected')).map(c=>c.textContent);const themeTwist=document.getElementById('qThemeTwist')?.value?.trim()||"";const hero=document.getElementById('qHero')?.value?.trim();const lowMid=document.getElementById('qLowMidSymbols')?.value?.trim();const bg=document.getElementById('qBG')?.value?.trim();const mood=document.getElementById('qMood')?.value?.trim();const atmospheres=Array.from(document.querySelectorAll('#atmosphereChips .theme-chip.selected')).map(c=>c.textContent);const atmCustom=document.getElementById('qAtmosphereCustom')?.value?.trim()||"";const markets=Array.from(document.querySelectorAll('#marketChips .theme-chip.selected')).map(c=>c.textContent);const marketsOther=document.getElementById('qMarketsOther')?.value?.trim()||"";const rtpProfiles=Array.from(document.querySelectorAll('#rtpChips .theme-chip.selected')).map(c=>c.textContent);const ctx=function(){return{model:document.getElementById('r-model')?.textContent?.trim()||"",grid:document.getElementById('r-grid')?.textContent?.trim()||"",vol:document.getElementById('r-vol')?.textContent?.trim()||"",max:document.getElementById('r-max')?.textContent?.trim()||"",rtp:document.getElementById('r-rtp')?.textContent?.trim()||"",ev:document.getElementById('r-ev')?.textContent?.trim()||"",hit:document.getElementById('r-hit')?.textContent?.trim()||"",cad:document.getElementById('r-cad')?.textContent?.trim()||""};}();const gridData=window.currentGridData||{};const payload={email:email,your_name:yourName,company_name:companyName,game_type:window.__selectedGameType||'slot',context:{model:ctx.model,grid:gridData.grid||ctx.grid,vol:ctx.vol,max:ctx.max,name:gameName,rtp_profiles:ctx.rtp,ev_split:ctx.ev,hit_rate:ctx.hit,cadence:ctx.cad},art:{style:styles.join(' / '),themes:themes,twist:themeTwist,hero:hero,low_mid_symbols:lowMid,background:bg,palette_mood:mood,atmospheres:atmospheres.concat(atmCustom?[atmCustom]:[])},markets:{selected:markets,other:marketsOther},rtp_profiles:rtpProfiles,source:"final",session_id:crypto.randomUUID?crypto.randomUUID():String(Date.now()),timestamp:new Date().toISOString(),prompt:prompt,grid:gridData.grid||"",symbols:gridData.symbols||{}};console.log('Creating game:',payload);const btn=document.getElementById('btnCreateGame');btn.textContent='Sending...';btn.disabled=true;(function(){const form=new FormData();form.append("payload",JSON.stringify(payload));return fetch(N8N_URL,{method:"POST",body:form});})().then(function(res){if(res.ok){btn.textContent='Game Created ✓';alert('Your Game Design Document has been sent! Check your email.');}else{btn.textContent='Create my Game';btn.disabled=false;alert('There was a problem, please try again.');}}).catch(function(err){console.error('Error:',err);btn.textContent='Create my Game';btn.disabled=false;alert('Could not connect. Please try again.');});}
window.ensureArtStyleSection=function(){insertCard();};window.openArtStyle=function(){const c=document.getElementById('artCard');if(c){c.scrollIntoView({behavior:'smooth'});return;}if(window.ensureArtStyleSection)window.ensureArtStyleSection();};})();

// FOCUS MODE
(function(){
function enterFocusFromModel(mid){
  const m=MODELS.find(x=>x.id===mid);
  if(!m){alert('Model not found.');return;}
  window.__selectedModelId=mid;
  window.__selectedGameType=m.gameType||'slot';

  // MINE GAME - different focus flow
  if(m.gameType==='mine'){
    ensureFocusBar();
    showMineResultBox(m);
    enterFocusUI(m.name,mid);
    return;
  }

  // SLOT GAME - existing flow
  let evDisplay=m.ev_split_target.base+'% base / '+m.ev_split_target.feature+'% feature';
  let hitDisplay=m.base_hit_rate_target_percent;
  let cadDisplay=m.feature_cadence_target_1inN;
  let maxDisplay=m.max_win_target_x;
  if(m.rtp_versions){const v96=m.rtp_versions[96];evDisplay='';const parts=[];if(v96.ev_split.base)parts.push('Base: '+v96.ev_split.base+'%');if(v96.ev_split.free_spins)parts.push('Free Spins: '+v96.ev_split.free_spins+'%');if(v96.ev_split.coin_feature)parts.push('Coin Feature: '+v96.ev_split.coin_feature+'%');if(v96.ev_split.coin_extra)parts.push('Coin Extra: '+v96.ev_split.coin_extra+'%');evDisplay=parts.join(' · ');hitDisplay=v96.hit_ratio;const cParts=[];if(v96.feature_cadence.coin_feature)cParts.push('Coin: 1 in '+v96.feature_cadence.coin_feature);if(v96.feature_cadence.coin_extra)cParts.push('Extra: 1 in '+v96.feature_cadence.coin_extra);if(v96.feature_cadence.free_spins)cParts.push('FS: 1 in '+v96.feature_cadence.free_spins);cadDisplay=cParts.join(' · ');maxDisplay=v96.max_win;}
  const rec={model:m.name,grid:m.canonical_grid+(m.lines?' / '+m.lines+' lines':''),targets:{rtp_profiles:m.rtp_profiles,ev_split_display:evDisplay,volatility:m.volatility,base_hit_rate_target_percent:hitDisplay,feature_cadence_target_1inN:cadDisplay,max_win_target_x:maxDisplay},toggles:{},jackpots:m.jackpots_supported?{native:true,tiers:{Mini:"20x",Minor:"50x",Major:"200x",Grand:"1,000x"}}:{}};
  ensureFocusBar();
  showResultBox(rec);
  enterFocusUI(m.name,mid);
}

function showMineResultBox(m){
  const rb=document.getElementById('resultBox');
  const s=(id,v)=>{const n=document.querySelector(id);if(n)n.textContent=v;};
  s('#r-model',m.name||'-');
  s('#r-grid',m.canonical_grid||'-');
  s('#r-vol',m.volatility_range||'-');
  s('#r-rtp',m.rtp_range||'-');
  s('#r-max',m.max_multiplier||'-');

  // For mine games, replace the KV content with mine-specific fields
  const kvEl=document.getElementById('r-kv');
  if(kvEl){
    kvEl.innerHTML=
      '<div>Game Type</div><div><span class="mine-type-badge mine">Mine Game</span></div>'+
      '<div>Grid</div><div id="r-grid">'+m.canonical_grid+'</div>'+
      '<div>Mines</div><div>'+m.mine_range.min+'–'+m.mine_range.max+' selectable per round</div>'+
      '<div>RTP Range</div><div id="r-rtp">'+m.rtp_range+'</div>'+
      '<div>Volatility</div><div id="r-vol">'+m.volatility_range+'</div>'+
      '<div>Max Multiplier</div><div id="r-max">'+m.max_multiplier+'</div>'+
      '<div>Bet Range</div><div>'+m.bet_range.min+' – '+m.bet_range.max+' (default: '+m.bet_range.default+')</div>'+
      '<div>Symbols</div><div>'+m.symbols+' (Coin + Mine)</div>'+
      '<div>Jackpots</div><div id="r-jp">—</div>'+
      '<div>Toggles</div><div id="r-tog">—</div>';
  }

  // Clear extra area for mine games
  const extraEl=document.getElementById('r-extra');
  if(extraEl)extraEl.innerHTML='';
}

function ensureFocusBar(){if(document.getElementById('focusBar'))return;const w=document.querySelector('.wrap .card')||document.body;const b=document.createElement('div');b.id='focusBar';b.innerHTML='<div><span class="badge">Focus</span> <span id="focusLabel" class="help"></span></div><div><button class="btn" id="showMeModels2">Show Me Models</button></div>';w.parentElement.insertBefore(b,w);document.getElementById('showMeModels2').onclick=()=>{exitFocus();document.getElementById('models').classList.remove('hidden');document.getElementById('modelsBtn').click();};}

function showResultBox(out){const t=out.targets||{};const jp=out.jackpots||{};const tog=out.toggles||{};
  // Reset KV to slot layout
  const kvEl=document.getElementById('r-kv');
  if(kvEl){
    kvEl.innerHTML=
      '<div>Grid</div><div id="r-grid"></div>'+
      '<div>Volatility</div><div id="r-vol"></div>'+
      '<div>RTP profiles</div><div id="r-rtp"></div>'+
      '<div>EV split</div><div id="r-ev"></div>'+
      '<div>Base hit-rate</div><div id="r-hit"></div>'+
      '<div>Feature cadence</div><div id="r-cad"></div>'+
      '<div>Max win</div><div id="r-max"></div>'+
      '<div>Jackpots</div><div id="r-jp"></div>'+
      '<div>Toggles</div><div id="r-tog"></div>';
  }
  const extraEl=document.getElementById('r-extra');
  if(extraEl)extraEl.innerHTML='';

  const s=(id,v)=>{const n=document.querySelector(id);if(n)n.textContent=v;};
  s('#r-model',out.model||'-');s('#r-grid',out.grid||'-');s('#r-vol',t.volatility||'-');s('#r-rtp',Array.isArray(t.rtp_profiles)?t.rtp_profiles.join(', '):'-');s('#r-ev',t.ev_split_display||((t.ev_split_target)?t.ev_split_target.base+'% base / '+t.ev_split_target.feature+'% feature':'-'));s('#r-hit',t.base_hit_rate_target_percent||'-');s('#r-cad',t.feature_cadence_target_1inN||'-');s('#r-max',t.max_win_target_x?t.max_win_target_x+(String(t.max_win_target_x).includes('×')?'':'×'):'-');s('#r-jp',jp.native?'Native (Mini/Minor/Major/Grand)':(tog.overlay_jackpot?'Overlay':'—'));s('#r-tog',Object.entries(tog).filter(([k,v])=>v).map(([k])=>k).join(', ')||'—');}

function enterFocusUI(label,mid){document.body.classList.add('focus-mode');const fl=document.getElementById('focusLabel');if(fl)fl.textContent='Selected: '+label;const rb=document.getElementById('resultBox');const fm=document.getElementById('focusMount');if(rb&&fm){const cl=rb.cloneNode(true);cl.id='focusBox';cl.style.display='';cl.classList.remove('hidden');const mn=cl.querySelector('#r-model');if(mn)mn.textContent=label;fm.appendChild(cl);setTimeout(()=>{cl.querySelectorAll('.personalize-btn').forEach(b=>b.remove());const ab=cl.querySelector('#artBtn');if(ab){ab.textContent="Create Game";ab.onclick=e=>{e.preventDefault();if(window.ensureArtStyleSection)window.ensureArtStyleSection();};}},100);}const mt=document.getElementById('focusMount');if(mt)mt.scrollIntoView({behavior:'smooth',block:'start'});}

function exitFocus(){document.body.classList.remove('focus-mode');const fl=document.getElementById('focusLabel');if(fl)fl.textContent='';const fm=document.getElementById('focusMount');if(fm)fm.innerHTML='';window.__selectedGameType=null;}
window.__slotFocus={enterFocusFromModel,exitFocus};
})();

// MAIN APP - RENDER MODEL CARDS
const modelsSec=document.getElementById('models');const modelsWrap=document.getElementById('modelsWrap');const modelsBtn=document.getElementById('modelsBtn');
modelsBtn.onclick=()=>{modelsSec.classList.remove('hidden');
  const displayOrder=['HoldAndWinRespin','HoldAndWin20Lines','PayAnywhere','MineGame'];
  const comingSoon=['PayAnywhere','MineGame'];
  const sorted=displayOrder.map(id=>MODELS.find(m=>m.id===id)).filter(Boolean);

  function evStr(ev){const parts=[];if(ev.base)parts.push('Base: '+ev.base+'%');if(ev.free_spins)parts.push('Free Spins: '+ev.free_spins+'%');if(ev.coin_feature)parts.push('Coin Feature: '+ev.coin_feature+'%');if(ev.coin_extra)parts.push('Coin Extra: '+ev.coin_extra+'%');return parts.join(' · ');}
  function cadStr(c){const parts=[];if(c.coin_feature)parts.push('Coin Feature: 1 in '+c.coin_feature);if(c.coin_extra)parts.push('Coin Extra: 1 in '+c.coin_extra);if(c.free_spins)parts.push('Free Spins: 1 in '+c.free_spins);return parts.join(' · ');}
  function rtpPanel(ver){return'<div class="rtp-panel"><div class="kv" style="font-size:13.5px;"><div>RTP</div><div>'+ver.rtp+'</div><div>Hit ratio</div><div>'+ver.hit_ratio+'</div><div>Max win</div><div>'+ver.max_win+'</div><div>EV split</div><div>'+evStr(ver.ev_split)+'</div><div>Cadence</div><div>'+cadStr(ver.feature_cadence)+'</div></div></div>';}

  // BUILD MINE GAME CARD
  function buildMineCard(m){
    const isc=comingSoon.includes(m.id);
    return '<div class="model-card" data-model-id="'+m.id+'">'+
      '<div style="display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:16px;">'+
        '<span class="mine-type-badge mine">Mine Game</span>'+
        '<div style="font-size:22px;font-weight:900;color:var(--accent);text-align:center;text-transform:uppercase;letter-spacing:2px;">'+m.name+(isc?'<span style="display:inline-block;background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;padding:4px 12px;border-radius:12px;font-size:11px;font-weight:700;margin-left:8px;">COMING SOON</span>':'')+'</div>'+
      '</div>'+
      '<div class="kv">'+
        '<div>Grid</div><div>'+m.canonical_grid+'</div>'+
        '<div>Mines</div><div>'+m.mine_range.min+'–'+m.mine_range.max+' selectable</div>'+
        '<div>RTP Range</div><div>'+m.rtp_range+'</div>'+
        '<div>Volatility</div><div>'+m.volatility_range+'</div>'+
        '<div>Max Multiplier</div><div>'+m.max_multiplier+'</div>'+
        '<div>Bet Range</div><div>'+m.bet_range.min+' – '+m.bet_range.max+'</div>'+
        '<div>Symbols</div><div>'+m.symbols+' (Coin + Mine)</div>'+
      '</div>'+
      (m.notes?.length?'<div class="help" style="margin-top:12px">Notes: '+m.notes.join(' • ')+'</div>':'')+
      '<div style="text-align:center;margin-top:16px;">'+
        (!isc?'<button class="btn-rose model-select-btn" data-model-id="'+m.id+'">Select</button>':'')+
      '</div>'+
    '</div>';
  }

  // BUILD SLOT CARD
  function buildSlotCard(m){
    const isc=comingSoon.includes(m.id);
    const hasVersions=!!m.rtp_versions;
    let kvHtml='';
    if(hasVersions){
      const uid=m.id+'_';
      kvHtml='<div class="kv"><div>Grid</div><div>'+m.canonical_grid+'</div><div>Lines</div><div>'+m.lines+'</div><div>Volatility</div><div>'+m.volatility+'</div><div>Jackpots</div><div>Mini / Minor / Major / Grand</div></div><div class="rtp-accordion"><div class="rtp-accordion-header" data-target="'+uid+'96"><span class="rtp-label">96% RTP</span><span class="rtp-chevron">▼</span></div><div class="rtp-accordion-body" id="'+uid+'96">'+rtpPanel(m.rtp_versions[96])+'</div><div class="rtp-accordion-header" data-target="'+uid+'94"><span class="rtp-label">94% RTP</span><span class="rtp-chevron">▼</span></div><div class="rtp-accordion-body" id="'+uid+'94">'+rtpPanel(m.rtp_versions[94])+'</div></div>';
    }else{
      kvHtml='<div class="kv"><div>Canonical grid</div><div>'+m.canonical_grid+'</div><div>Variants</div><div>'+m.grid_variants.join(' · ')+'</div><div>RTP</div><div>'+m.rtp_profiles.join(', ')+'</div><div>Volatility</div><div>'+m.volatility+'</div><div>EV split</div><div>'+m.ev_split_target.base+'% base / '+m.ev_split_target.feature+'% feature</div><div>Base hit-rate</div><div>'+m.base_hit_rate_target_percent+'%</div><div>Feature cadence</div><div>1 in '+m.feature_cadence_target_1inN+'</div><div>Max win</div><div>'+m.max_win_target_x+'×</div></div>';
    }
    return '<div class="model-card" data-model-id="'+m.id+'"><div style="display:flex;align-items:center;justify-content:center;gap:10px;margin-bottom:16px;"><span class="mine-type-badge slot">Slot</span><div style="font-size:22px;font-weight:900;color:var(--accent);text-align:center;text-transform:uppercase;letter-spacing:2px;">'+m.name+(isc?'<span style="display:inline-block;background:linear-gradient(135deg,#f59e0b,#d97706);color:#fff;padding:4px 12px;border-radius:12px;font-size:11px;font-weight:700;margin-left:8px;">COMING SOON</span>':'')+'</div></div>'+kvHtml+(m.notes?.length?'<div class="help" style="margin-top:12px">Notes: '+m.notes.join(' • ')+'</div>':'')+'<div style="text-align:center;margin-top:16px;">'+(!isc?'<button class="btn-rose model-select-btn" data-model-id="'+m.id+'">Select</button>':'')+'</div></div>';
  }

  modelsWrap.innerHTML=sorted.map(m=>{
    if(m.gameType==='mine')return buildMineCard(m);
    return buildSlotCard(m);
  }).join('');

  // Wire accordion
  document.querySelectorAll('.rtp-accordion-header').forEach(h=>{h.onclick=function(){const tid=this.dataset.target;const body=document.getElementById(tid);if(body){body.classList.toggle('open');this.classList.toggle('open');}};});
  // Wire select buttons
  document.querySelectorAll('.model-select-btn').forEach(btn=>{btn.onclick=function(e){e.preventDefault();const mid=this.dataset.modelId;if(window.__slotFocus)window.__slotFocus.enterFocusFromModel(mid);};});
};

</script></body></html>
